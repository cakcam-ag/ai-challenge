<!DOCTYPE html>
<html>
<head>
<title>Day 14 ‚Äî RAG Query Comparison</title>
<meta charset="UTF-8">
<style>
body { 
    background:#111; 
    color:#eee; 
    font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; 
    padding:20px; 
    max-width:1400px;
    margin:0 auto;
}
h1 { color:#4caf50; margin-bottom:4px; }
h2 { color:#81c784; margin-top:30px; margin-bottom:10px; }
.subtitle { color:#aaa; margin-bottom:20px; font-size:0.9rem; }
button { 
    padding:10px 15px; 
    margin-top:10px; 
    border:none; 
    border-radius:6px; 
    background:#4caf50; 
    color:white; 
    cursor:pointer;
    font-size:1rem;
    margin-right:8px;
}
button:hover { background:#45a049; }
button:disabled { background:#555; cursor:not-allowed; }
button.secondary {
    background:#2196F3;
}
button.secondary:hover {
    background:#1976D2;
}
textarea, input { 
    width:100%; 
    margin-top:10px; 
    background:#222; 
    color:#fff; 
    border:1px solid #444; 
    padding:10px; 
    border-radius:4px;
    box-sizing:border-box;
    font-size:1rem;
}
textarea { min-height:100px; }
.comparison-container {
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:20px;
    margin-top:20px;
}
.answer-box {
    background:#1e1e1e; 
    padding:15px; 
    border-radius:6px;
    border-left:4px solid #4caf50;
}
.answer-box.without-rag {
    border-left-color:#f44336;
}
.answer-box.with-rag {
    border-left-color:#4caf50;
}
.answer-box h3 {
    margin-top:0;
    color:#4caf50;
}
.answer-box.without-rag h3 {
    color:#f44336;
}
.chunks-list {
    margin-top:15px;
    padding:10px;
    background:#263238;
    border-radius:4px;
    font-size:0.9rem;
}
.chunk-item {
    margin-bottom:10px;
    padding:8px;
    background:#1a1a1a;
    border-radius:4px;
    border-left:3px solid #81c784;
}
.chunk-item strong {
    color:#81c784;
    display:block;
    margin-bottom:4px;
}
.comparison-box {
    grid-column: 1 / -1;
    background:#263238;
    padding:20px;
    border-radius:6px;
    border-left:4px solid #FF9800;
    margin-top:20px;
}
.comparison-box h3 {
    color:#FF9800;
    margin-top:0;
}
.status { 
    background:#263238; 
    padding:12px; 
    margin-top:10px; 
    border-radius:4px; 
    border-left:4px solid #4caf50;
}
.status.error { border-left-color:#d32f2f; color:#ff6b6b; }
.loading {
    color:#81c784;
    font-style:italic;
}
</style>
</head>
<body>

<h1>üîç Day 14 ‚Äî RAG Query Comparison</h1>
<p class="subtitle">Compare answers with RAG (Retrieval-Augmented Generation) vs without RAG</p>

<h2>1. Rebuild Index</h2>
<p class="subtitle">Process documents from <code>data/docs/</code> directory</p>
<button onclick="reindex()" id="reindexBtn">Reindex Documents</button>
<div id="status"></div>

<h2>2. Ask a Question</h2>
<p class="subtitle">Enter a question to compare answers with and without RAG</p>
<textarea id="question" placeholder="e.g., What are viral loops? How do AI agents work? What is an LLM?"></textarea>
<button onclick="compare()" id="compareBtn">Compare Answers</button>
<button onclick="queryWithoutRAG()" class="secondary" id="withoutRagBtn">Without RAG Only</button>
<button onclick="queryWithRAG()" class="secondary" id="withRagBtn">With RAG Only</button>

<div id="results" style="display:none;">
    <div class="comparison-container" id="comparisonContainer"></div>
    <div class="comparison-box" id="comparisonBox" style="display:none;"></div>
</div>

<script>
async function reindex() {
    const btn = document.getElementById("reindexBtn");
    const status = document.getElementById("status");
    btn.disabled = true;
    status.innerHTML = '<div class="status loading">Building index... This may take a moment.</div>';
    
    try {
        const res = await fetch("/reindex", { method:"POST" });
        const data = await res.json();
        
        if (data.success) {
            status.innerHTML = `<div class="status">‚úÖ ${data.message || "Index rebuilt successfully!"}</div>`;
        } else {
            status.innerHTML = `<div class="status error">‚ùå Error: ${data.error || "Unknown error"}</div>`;
        }
    } catch (err) {
        status.innerHTML = `<div class="status error">‚ùå Error: ${err.message}</div>`;
    } finally {
        btn.disabled = false;
    }
}

async function queryWithoutRAG() {
    const question = document.getElementById("question").value.trim();
    if (!question) {
        alert("Please enter a question.");
        return;
    }
    
    const btn = document.getElementById("withoutRagBtn");
    const resultsDiv = document.getElementById("results");
    const container = document.getElementById("comparisonContainer");
    
    btn.disabled = true;
    container.innerHTML = '<div class="status loading">Getting answer without RAG...</div>';
    resultsDiv.style.display = "block";
    
    try {
        const res = await fetch("/query_without_rag", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({question})
        });
        const data = await res.json();
        
        if (data.success) {
            container.innerHTML = `
                <div class="answer-box without-rag">
                    <h3>‚ùå Without RAG</h3>
                    <div style="white-space:pre-wrap; line-height:1.6;">${data.answer}</div>
                </div>
            `;
        } else {
            container.innerHTML = `<div class="status error">‚ùå Error: ${data.error}</div>`;
        }
    } catch (err) {
        container.innerHTML = `<div class="status error">‚ùå Error: ${err.message}</div>`;
    } finally {
        btn.disabled = false;
    }
}

async function queryWithRAG() {
    const question = document.getElementById("question").value.trim();
    if (!question) {
        alert("Please enter a question.");
        return;
    }
    
    const btn = document.getElementById("withRagBtn");
    const resultsDiv = document.getElementById("results");
    const container = document.getElementById("comparisonContainer");
    
    btn.disabled = true;
    container.innerHTML = '<div class="status loading">Getting answer with RAG...</div>';
    resultsDiv.style.display = "block";
    
    try {
        const res = await fetch("/query_with_rag", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({question, top_k:3})
        });
        const data = await res.json();
        
        if (data.success) {
            const chunksHtml = data.chunks_used.length > 0 ? `
                <div class="chunks-list">
                    <strong>üìÑ Documents Used:</strong>
                    ${data.chunks_used.map(c => `
                        <div class="chunk-item">
                            <strong>${c.file}</strong> (relevance: ${c.score.toFixed(3)})
                            <div style="margin-top:4px; color:#aaa; font-size:0.85rem;">${c.chunk}</div>
                        </div>
                    `).join("")}
                </div>
            ` : "";
            
            container.innerHTML = `
                <div class="answer-box with-rag">
                    <h3>‚úÖ With RAG</h3>
                    <div style="white-space:pre-wrap; line-height:1.6;">${data.answer}</div>
                    ${chunksHtml}
                </div>
            `;
        } else {
            container.innerHTML = `<div class="status error">‚ùå Error: ${data.error}</div>`;
        }
    } catch (err) {
        container.innerHTML = `<div class="status error">‚ùå Error: ${err.message}</div>`;
    } finally {
        btn.disabled = false;
    }
}

async function compare() {
    const question = document.getElementById("question").value.trim();
    if (!question) {
        alert("Please enter a question.");
        return;
    }
    
    const btn = document.getElementById("compareBtn");
    const resultsDiv = document.getElementById("results");
    const container = document.getElementById("comparisonContainer");
    const comparisonBox = document.getElementById("comparisonBox");
    
    btn.disabled = true;
    container.innerHTML = '<div class="status loading">Comparing answers... This may take a moment.</div>';
    comparisonBox.style.display = "none";
    resultsDiv.style.display = "block";
    
    try {
        const res = await fetch("/compare", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({question, top_k:3})
        });
        const data = await res.json();
        
        if (data.success) {
            const chunksHtml = data.with_rag.chunks_used.length > 0 ? `
                <div class="chunks-list">
                    <strong>üìÑ Documents Used:</strong>
                    ${data.with_rag.chunks_used.map(c => `
                        <div class="chunk-item">
                            <strong>${c.file}</strong> (relevance: ${c.score.toFixed(3)})
                            <div style="margin-top:4px; color:#aaa; font-size:0.85rem;">${c.chunk}</div>
                        </div>
                    `).join("")}
                </div>
            ` : "";
            
            container.innerHTML = `
                <div class="answer-box without-rag">
                    <h3>‚ùå Without RAG</h3>
                    <div style="white-space:pre-wrap; line-height:1.6;">${data.without_rag.answer}</div>
                </div>
                <div class="answer-box with-rag">
                    <h3>‚úÖ With RAG</h3>
                    <div style="white-space:pre-wrap; line-height:1.6;">${data.with_rag.answer}</div>
                    ${chunksHtml}
                </div>
            `;
            
            comparisonBox.innerHTML = `
                <h3>üìä Comparison Analysis</h3>
                <div style="white-space:pre-wrap; line-height:1.6;">${data.comparison}</div>
            `;
            comparisonBox.style.display = "block";
        } else {
            container.innerHTML = `<div class="status error">‚ùå Error: ${data.error || "Unknown error"}</div>`;
        }
    } catch (err) {
        container.innerHTML = `<div class="status error">‚ùå Error: ${err.message}</div>`;
    } finally {
        btn.disabled = false;
    }
}

// Allow Enter key to trigger comparison (Shift+Enter for newline)
document.getElementById("question").addEventListener("keydown", function(e) {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        compare();
    }
});
</script>

</body>
</html>

